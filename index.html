<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftBuy - Магазин электроники</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Объединенная шапка с названием, навигацией и поиском -->
<nav class="main-nav">
    <div class="nav-brand">
        <h1>SwiftBuy</h1>
    </div>
    <div class="nav-links">
        <a href="#">Главная</a>
        <a href="#">Магазин</a>
        <a href="#">Доставка и оплата</a>
        <a href="#">О нас</a>
        <div class="nav-search">
        <div class="search-wrapper">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" name="Search" class="search-input" placeholder="Поиск товаров..." autocomplete="off">
            <button class="search-clear" id="search-clear" style="display: none;">×</button>
        </div>
        </div>
    </div>
</nav>

<!-- ОСНОВНОЙ КОНТЕЙНЕР С ФИЛЬТРАМИ И КАРТОЧКАМИ -->
<div class="main-content-wrapper">
    <!-- ЛЕВАЯ КОЛОНКА С ФИЛЬТРАМИ -->
    <div class="filters-container">
        <!-- Информационный блок с количеством товаров -->
        <div class="info-section">
            <div class="info-item">
                <span class="info-label">Товаров на сайте:</span>
                <span class="info-value" id="products-count">0</span>
            </div>
        </div>
        <div class="CheckBox">
            <h1>Категории</h1>
            
            <div class="checkbox-group" id="categories-filter">
                <!-- Категории будут загружены динамически -->
                <div class="loading-categories">Загрузка категорий...</div>
            </div>
        </div>
    </div>

    <!-- ПРАВАЯ КОЛОНКА С КАРТОЧКАМИ -->
    <div class="products-container">
        <div class="products-grid" id="products-grid">
            <!-- Карточки будут загружаться динамически -->
            <div class="loading">Загрузка товаров...</div>
        </div>
        
        <!-- Пагинация -->
        <div class="pagination-container" id="pagination-container">
            <!-- Кнопки пагинации будут добавлены динамически -->
        </div>
    </div>
</div>

<footer>
    <div class="footer-content">
        <div class="footer-description">
            <p>Основанные на передовых технологиях и инновационных решениях, устройства SwiftBuy позволяют вам пользоваться последними достижениями технического прогресса вместе с проверенной надежностью ведущих мировых брендов. Каждое устройство в нашем каталоге проходит многоуровневую проверку качества, что гарантирует безупречную работу и долговечность эксплуатации.</p>
        </div>
        <p class="footer-copyright">&copy; 2025 SwiftBuy. Все права защищены.</p>
    </div>
</footer>

<script>
// Глобальные переменные
let allProducts = [];
let filteredProducts = [];
let currentPage = 1;
const productsPerPage = 12; // 4 ряда по 3 товара

// Функция для загрузки товаров
async function loadProducts() {
    try {
        const response = await fetch('http://localhost:3000/products');
        allProducts = await response.json();
        filteredProducts = [...allProducts];
        
        // Обновляем количество товаров
        updateProductsCount();
        
        // Загружаем категории и отображаем товары
        setupCategories();
        displayProducts();
    } catch (error) {
        console.error('Ошибка при загрузке товаров:', error);
        document.getElementById('products-grid').innerHTML = 
            '<div class="error">Ошибка загрузки товаров. Проверьте подключение к серверу.</div>';
    }
}

// Функция для обновления количества товаров
function updateProductsCount() {
    const countElement = document.getElementById('products-count');
    if (countElement) {
        countElement.textContent = allProducts.length;
    }
}

// Функция для настройки категорий
function setupCategories() {
    // Получаем уникальные категории из товаров
    const categories = [...new Set(allProducts.map(p => p.category).filter(c => c))];
    const categoriesFilter = document.getElementById('categories-filter');
    
    if (categories.length === 0) {
        categoriesFilter.innerHTML = '<div class="no-categories">Категории не найдены</div>';
        return;
    }
    
    categoriesFilter.innerHTML = categories.map(category => `
        <div class="checkbox-item">
            <input type="checkbox" id="cat-${category.replace(/\s+/g, '-')}" 
                   value="${category}" onchange="filterByCategories()">
            <label for="cat-${category.replace(/\s+/g, '-')}">${category}</label>
        </div>
    `).join('');
}

// Функция для фильтрации по категориям
function filterByCategories() {
    const checkedCategories = Array.from(document.querySelectorAll('#categories-filter input[type="checkbox"]:checked'))
        .map(cb => cb.value);
    
    if (checkedCategories.length === 0) {
        // Если ничего не выбрано, показываем все товары
        filteredProducts = [...allProducts];
    } else {
        // Фильтруем товары по выбранным категориям
        filteredProducts = allProducts.filter(product => 
            product.category && checkedCategories.includes(product.category)
        );
    }
    
    currentPage = 1; // Сбрасываем на первую страницу
    displayProducts();
}

// Функция для отображения товаров с пагинацией
function displayProducts() {
    const productsGrid = document.getElementById('products-grid');
    
    if (!filteredProducts || filteredProducts.length === 0) {
        productsGrid.innerHTML = '<div class="no-products">Товары не найдены</div>';
        document.getElementById('pagination-container').innerHTML = '';
        return;
    }
    
    // Вычисляем пагинацию
    const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const productsToShow = filteredProducts.slice(startIndex, endIndex);
    
    // Отображаем товары
    productsGrid.innerHTML = productsToShow.map(product => `
        <div class="product-card">
            <div class="product-image">
                <img src="${product.image_url || 'https://via.placeholder.com/200x250?text=No+Image'}" 
                     alt="${product.name}" 
                     onerror="this.src='https://via.placeholder.com/200x250?text=No+Image'">
            </div>
            <div class="product-content">
                <div class="product-category">${product.category || 'Электроника'}</div>
                <h3 class="product-title">${product.name}</h3>
                <div class="product-description">${product.description || ''}</div>
                <div class="product-features">
                    <span class="feature">Арт: ${product.article}</span>
                    ${product.supplier ? `<span class="feature">${product.supplier}</span>` : ''}
                    ${product.quantity ? `<span class="feature">В наличии: ${product.quantity}</span>` : ''}
                </div>
                <div class="product-price">
                    <span class="current-price">${product.price ? product.price + ' руб.' : 'Цена не указана'}</span>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart(${product.id})">В корзину</button>
            </div>
        </div>
    `).join('');
    
    // Отображаем пагинацию
    displayPagination(totalPages);
}

// Функция для отображения пагинации
function displayPagination(totalPages) {
    const paginationContainer = document.getElementById('pagination-container');
    
    if (totalPages <= 1) {
        paginationContainer.innerHTML = '';
        return;
    }
    
    let paginationHTML = '<div class="pagination">';
    
    // Кнопки страниц
    for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `
            <button class="pagination-btn ${i === currentPage ? 'active' : ''}" 
                    onclick="goToPage(${i})">
                ${i}
            </button>
        `;
    }
    
    paginationHTML += '</div>';
    paginationContainer.innerHTML = paginationHTML;
}

// Функция для перехода на страницу
function goToPage(page) {
    const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
    if (page < 1 || page > totalPages) return;
    
    currentPage = page;
    displayProducts();
    
    // Плавная прокрутка вверх
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Функция добавления в корзину
function addToCart(productId) {
    // Здесь можно добавить логику для корзины
    alert('Товар добавлен в корзину! ID: ' + productId);
    
    // Пример сохранения в localStorage
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    if (!cart.includes(productId)) {
        cart.push(productId);
        localStorage.setItem('cart', JSON.stringify(cart));
    }
}

// Поиск товаров
function setupSearch() {
    const searchInput = document.querySelector('.search-input');
    const searchClear = document.getElementById('search-clear');
    
    if (searchInput) {
        // Обработка ввода
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            
            // Показываем/скрываем кнопку очистки
            if (searchTerm.length > 0) {
                searchClear.style.display = 'flex';
            } else {
                searchClear.style.display = 'none';
            }
            
            if (searchTerm === '') {
                filteredProducts = [...allProducts];
            } else {
                filteredProducts = allProducts.filter(product => 
                    (product.name && product.name.toLowerCase().includes(searchTerm)) ||
                    (product.description && product.description.toLowerCase().includes(searchTerm)) ||
                    (product.article && product.article.toLowerCase().includes(searchTerm))
                );
            }
            
            currentPage = 1;
            displayProducts();
        });
        
        // Очистка поиска
        if (searchClear) {
            searchClear.addEventListener('click', function() {
                searchInput.value = '';
                searchClear.style.display = 'none';
                filteredProducts = [...allProducts];
                currentPage = 1;
                displayProducts();
                searchInput.focus();
            });
        }
    }
}

// Загружаем товары при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    loadProducts();
    setupSearch();
});
</script>

</body>
</html>
